<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w.org/TR/html4/loose.dtd">
<title>トムリンズクエスト２</title>
<html lang="ja">
<meta charset="utf-8">
<body bgcolor="#000000" style="background-size: cover; background-position: center; background-repeat: no-repeat; background-attachment: fixed;  text-align:center; font-size: 30px;">
<script type="text/javascript">
    document.body.style.backgroundColor = "#000000";            // 背景色を変更
document.body.style.color = "#ffffff";  // 文字色を変更

var name = localStorage.getItem("name");       // プレイヤーの名前
var lv = parseInt(localStorage.getItem("lv"));         // プレイヤーのレベル
var hp = parseInt(localStorage.getItem("hp"));         // プレイヤーのHP
var mp = parseInt(localStorage.getItem("mp"));         // プレイヤーのMP
var flame = parseInt(localStorage.getItem("flame"));   // 炎の宝玉
var ice = parseInt(localStorage.getItem("ice"));       // 氷の宝玉
var thunder = parseInt(localStorage.getItem("thunder"));  // 雷の宝玉

sessionStorage.setItem('px', 22);
sessionStorage.setItem('py', 23);

var audio1 = new Audio("城.mp3");

preparation();

function preparation(){
    document.body.style.color = "#ffffff";
    audio1.loop = 'true';
    audio1.play();
    castle1();
}

function castle1(){
        backimage("城背景.jpg");
        putreset();
        putImage("王様.png");
        putWindow("王：よくぞ戻ってきた" + name + "よ。<br>まだゲームを続けるか？");
        putButton("はい.png", "castle2()");
        putButton("いいえ.png", "castle3()");
}

function castle2(){
        putreset();
        putImage("王様.png");
        putWindow("王：そうか。まずは、ゆっくり休むがいい。");
        putButton("NEXT.png", "Sleep()");
}

function castle3(){
        putreset();
        putImage("王様.png");
        putWindow("王：そうか。しばらくの間、休むがいい。");
        putButton("NEXT.png", "title0()");
}

function title0(){
        hp = lv + 10;
        mp = lv - 1;
        localStorage.setItem("name", name);
        localStorage.setItem("lv", lv);
        localStorage.setItem("flame", flame);
        localStorage.setItem("ice", ice);
        localStorage.setItem("thunder", thunder);
        localStorage.setItem("hp", hp);
        localStorage.setItem("mp", mp);
        putreset();
        putSpace();
        putStatus();
        document.body.style.backgroundImage = "";
        putWindow(name + "のHPとMPが全快した。<br>「NEXT」ボタンでタイトルにもどります。");
        putButton("NEXT.png", "next()");
}

function Sleep(){
        hp = lv + 10;
        mp = lv - 1;
        putreset();
        putSpace();
        putStatus();
        document.body.style.backgroundImage = "";
        putWindow(name + "のHPとMPが全快した。");
        putButton("NEXT.png", "judgement()");
}

function judgement(){
    if(thunder == 1){
        thunder1();
    }else if(ice == 1){
        ice1();
    }else if(flame == 1){
        flame1();
    }else{
        castle4();
    }
}

function castle4(){
    backimage("城背景.jpg");
    putreset();
    putImage("王様.png");
    putWindow("王：まずは、北にある炎の村にある炎の宝玉を村長から借りてくるのじゃ。");
    putButton("NEXT.png", "castle5()");
}

function flame1(){
    backimage("城背景.jpg");
    putreset();
    putImage("王様.png");
    putWindow("王：次は、西にある氷の街の大金持ちが持っている<br>氷の宝玉を譲ってもらうのじゃ。");
    putButton("NEXT.png", "castle5()");
}

function ice1(){
    backimage("城背景.jpg");
    putreset();
    putImage("王様.png");
    putWindow("王：最後に、東にある雷の村から雷の宝玉を探してくるのじゃ。");
    putButton("NEXT.png", "castle5()");
}

function thunder1(){
        backimage("城背景.jpg");
        putreset();
        putImage("王様.png");
        putWindow("雷の宝玉を渡しますか？");
        putButton("はい.png", "thunder2()");
        putButton("いいえ.png", "ice1()");
}

function castle5(){
        putreset();
        putImage("王様.png");
        putWindow("王：では行くがいい勇者" + name + "よ。");
        putButton("NEXT.png", "castle_end()");
}

function thunder2(){
        putreset();
        putImage("王様.png");
        putWindow("王：こ・・・これで復活できる・・・。");
        putButton("NEXT.png", "thunder3()");
}

function thunder3(){
        putreset();
        putImage("王様.png");
        putWindow("王：よくやってくれた勇者よ。");
        putButton("NEXT.png", "thunder4()");
}

function thunder4(){
        putreset();
        putImage("王様.png");
        putWindow("王：わしじゃよ。わし・・・");
        putButton("NEXT.png", "thunder5()");
}

function thunder5(){
        putreset();
        putImage("魔王.png");
        putWindow("魔王：魔王じゃ。");
        putButton("NEXT.png", "thunder6()");
}


function thunder6(){
        putreset();
        putImage("魔王.png");
        putWindow("魔王：おぬしは、わしを倒したつもりじゃったろうが<br>わしは不死身なのじゃ。");
        putButton("NEXT.png", "thunder7()");
}

function thunder7(){
        putreset();
        putImage("魔王.png");
        putWindow("魔王：ただ、おぬしに倒されたとき、<br>わしが持っていた力が３つに分かれて散らばっただけで・・・");
        putButton("NEXT.png", "thunder8()");
}

function thunder8(){
        putreset();
        putImage("魔王.png");
        putWindow("魔王：そんなことはどうでもいい。<br>今度こそ、この世界を滅ぼしてくれるわ！！");
        putButton("NEXT.png", "thunder9()");
}

function thunder9(){
        putreset();
        putImage("魔王.png");
        putWindow("魔王：その前に貴様から血祭りにあげなければいけないな・・・");
        putButton("NEXT.png", "thunder10()");
}

function thunder10(){
    localStorage.setItem("name", name);
    localStorage.setItem("lv", lv);
    localStorage.setItem("flame", flame);
    localStorage.setItem("ice", ice);
    localStorage.setItem("thunder", thunder);
    localStorage.setItem("hp", hp);
    localStorage.setItem("mp", mp);
    location.href = "boss.html";
}

function castle_end(){
    localStorage.setItem("name", name);
    localStorage.setItem("lv", lv);
    localStorage.setItem("flame", flame);
    localStorage.setItem("ice", ice);
    localStorage.setItem("thunder", thunder);
    localStorage.setItem("hp", hp);
    localStorage.setItem("mp", mp);
    location.href = "field.html";
}

function putWindow(str){
    put("<div style=\"border:3px solid #ffffff; background:#000000;  border-radius:6px; text-align:left;\">" + str + "<div style = \"text-align:center\">▼</div>" + "</div>");
}

function putCenterWindow(str){
    put("<div style=\"border:3px solid #ffffff; background:#000000;  border-radius:6px; text-align:center;\">" + str + "</div>");
}

function putStatus(){
    putCenterWindow(name + "　Lv" + lv + "　HP" + hp + "　MP" + mp);
}

function putButton(str1, str2){
    put("<button type=\"button\" style=\"background-color:#000000;\" onClick=\"" + str2 + "\"><IMG src=\"" + str1 + "\" width=\"190\" height=\"45\" border=\"0\"></button>");
}

function putImage(str){
    put("<br><br><img src=\"" + str + "\"><br>");
}

function putBossImage(){
    put("<img src=\"ラスボス.png\"><br>");
}

function putSpace(){
    put("<br><br><br><br>");
}

function putGameOver(){
    document.body.style.color = "#ff3300";
    putreset();
    putSpace();
    putStatus();
    document.body.style.backgroundImage = "";
    putWindow("GAME OVER<br>" + name + "は、力尽きてしまった。<br>「NEXT」ボタンでタイトルにもどります。" );
    putButton("NEXT.png", "next()");
}

function next(){
    location.href = "index.html";
}

function putNameInput(){
    putCenterWindow("<form name=\"js\">右の枠の中に入力してください。<input type=\"text\" name=\"txtb\" value=\"\" onkeypress=\"disp(event.keyCode);\"><input type=\"text\" style=\"visibility:hidden\"></form>");
}

function put(str){
    document.body.innerHTML += str + "<br>";
}

function putreset(){
    document.body.innerHTML = "";
}

function backimage(str){
    document.body.style.backgroundImage = "url(" + str + ")";
}


function addHP(val){
    hp += val;
    if (hp <= 0){
        hp = 0;
        document.body.style.color = "#ff3300";
    }else if((lv + 10) / 4 > hp){
        document.body.style.color = "#ffaa00";
    }else{
        document.body.style.color = "#ffffff";
    }
}

</script>
</body>
</html>